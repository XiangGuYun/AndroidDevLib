### 实现原理
> 基于在Activity中添加 ____ 的Fragment，通过Fragment接收Activity传递的生命周期。
> Fragment和 ____ 基于 ____ 接口建立联系，并传递生命周期事件，实现生命周期感知。
> 

<details>
<summary>查看答案</summary>
<pre>
无UI RequestManager LifeCycle
</pre>
</details>

### 如何绑定生命周期
在调用Glide.with(Activity activity)的时候
```java
 // with入口
 public static RequestManager with(@NonNull FragmentActivity activity) {
     return getRetriever(activity).get(activity);
 }

 // 此处拿到对应的 FragmentManager，为生成Fragment做准备
 public RequestManager get(@NonNull FragmentActivity activity) {
     if(Util.isOnBackgroundThread()) {
         return this.get(activity.getApplicationContext());
     } else {
         assertNotDestroyed(activity);
         android.support.v4.app.FragmentManager fm = activity.getSupportFragmentManager();
         return this.supportFragmentGet(activity, fm, (Fragment)null, isActivityVisible(activity));
     }
 }
 
 private RequestManager supportFragmentGet(@NonNull Context context, @NonNull android.support.v4.app.FragmentManager fm, @Nullable Fragment parentHint, boolean isParentVisible) {
 	// current就是一个无UI的Fragment实例
     SupportRequestManagerFragment current = this.getSupportRequestManagerFragment(fm, parentHint, isParentVisible);
     RequestManager requestManager = current.getRequestManager();
     if(requestManager == null) {
         Glide glide = Glide.get(context);
 		// 将Fragment的LifeCycle传入RequestManager中，建立起来联系
         requestManager = this.factory.build(glide, current.getGlideLifecycle(), current.getRequestManagerTreeNode(), context);
         current.setRequestManager(requestManager);
     }

     return requestManager;
 }

 //RequestManager的构造方法中绑定LifeCycle，将自己的引用存入LifeCycle，调用LifeCycle的生命周期时进行回调
 lifecycle.addListener(this);

```
稍微整理一下就是：
1. Glide绑定Activity时，生成一个无UI的Fragment
2. 将无UI的Fragment的LifeCycle传入到RequestManager中
3. 在RequestManager的构造方法中，将RequestManager存入到之前传入的Fragment的LifeCycle，在回调LifeCycle时会回调到Glide的相应方法

### 回调的源码
```java
 //RequestManager的构造方法中绑定LifeCycle，将自己的引用存入LifeCycle，调用LifeCycle的生命周期时进行回调
 //这个this是RequestManager的实例
 lifecycle.addListener(this);

 // onDestory的回调示例
 void onDestroy() {
     this.isDestroyed = true;
     Iterator var1 = Util.getSnapshot(this.lifecycleListeners).iterator();

     while(var1.hasNext()) {
         LifecycleListener lifecycleListener = (LifecycleListener)var1.next();
         lifecycleListener.onDestroy();
     }

 }

 //下面看一下RequestManager里面的onDestory方法，里面主要做一些解绑和清除操作
 public void onDestroy() {
     this.targetTracker.onDestroy();
     Iterator var1 = this.targetTracker.getAll().iterator();

     while(var1.hasNext()) {
         Target<?> target = (Target)var1.next();
         this.clear(target);
     }

     this.targetTracker.clear();
     this.requestTracker.clearRequests();
     this.lifecycle.removeListener(this);
     this.lifecycle.removeListener(this.connectivityMonitor);
     this.mainHandler.removeCallbacks(this.addSelfToLifecycle);
     this.glide.unregisterRequestManager(this);
 }

```